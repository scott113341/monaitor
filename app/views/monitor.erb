<h1>Determine <%= @monitor[:determine] %></h1>
<p>URL: <a href="<%= @monitor[:url] %>" target="_blank"><%= @monitor[:url] %></a></p>

<form method="post" action="/monitors/<%= @monitor[:id] %>/run">
  <button type="submit">Run now</button>
</form>

<% if @runs.empty? %>
  <p>No runs yet.</p>
<% else %>
  <table>
    <thead>
    <tr>
      <th>When</th>
      <th>Determination</th>
      <th>Usage</th>
      <th>Rationale</th>
      <th>Screenshot</th>
    </tr>
    </thead>
    <tbody>
    <% @runs.each do |run| %>
      <tr>
        <td>
          <span title="<%= run[:created_at] %>">
            <%= "#{time_ago_in_words(run[:created_at])} ago" %>
          </span>
        </td>
        <td><%= run[:outcome] %></td>
        <td>
          In: <%= run[:debug_info]["input_tokens"] %>
          <br>
          Out: <%= run[:debug_info]["output_tokens"] %>
          <br>
          Cost: $<%= sprintf('%.5f', (run[:debug_info]["input_tokens"] * 0.10 + run[:debug_info]["output_tokens"] * 0.40) / 1_000_000) %>
        </td>
        <td style="white-space: pre-line"><%= run[:debug_info]["content"] %></td>
        <td>
          <a href="/runs/<%= run[:id] %>/screenshot" target="_blank">
            <img src="/runs/<%= run[:id] %>/screenshot" width="200" alt="Screenshot">
          </a>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
<% end %>
